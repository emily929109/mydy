<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping Demo</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="styles/style.min.css" />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
      }

      img {
        width: 100%;
        max-width: 80px;
        display: block;
        margin: 0 auto;
      }

      .card {
        height: 100%;
        width: auto;
        display: flex;
        min-width: 0;
      }

      .card-body {
        display: flex;
        flex-direction: column;
      }

      .card-img-top {
        padding: 1rem 0;
      }

      .btn.btn-primary {
        display: block;
      }

      .card-body input {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="wrapper container mx-auto mt-5" id="app">
      <button class="btn btn-secondary mb-4" @click="toggleSidebar">
        購物車
      </button>
      <div class="row">
        <!-- item -->
        <div
          class="col-12 col-md-4 item-card"
          v-for="(item,i) in inventory.slice(0,3)"
        >
          <div class="card">
            <img src="img/carrot.png" class="card-img-top" alt="..." />
            <div class="card-body">
              <h5 class="card-title">{{item.name}}</h5>
              <div class="card-text mb-2">
                <span>Type : </span>{{item.type}}
              </div>
              <div class="card-text mb-2">
                <span>Price : </span>${{item.price.USD}}
              </div>
              <!--在inventory創立新的屬性quantity-->
              <input
                type="number"
                class="form-control mb-3"
                v-model="inventory[i].quantity"
              />

              <button
                class="btn btn-primary"
                @click="addToCart(item.name, inventory[i].quantity)"
              >
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      </div>
      <sidebar v-if="showCart" :toggle="toggleSidebar" :cart="cart"></sidebar>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script
      src="https://kit.fontawesome.com/7c6bbc6b90.js"
      crossorigin="anonymous"
    ></script>
    <script>
      let app = Vue.createApp({
        data() {
          return {
            inventory: [],
            cart: {},
            showCart: true, //是否顯示購物車
          };
        },
        methods: {
          addToCart(item, quantity) {
            if (!this.cart[item]) {
              this.cart[item] = 0;
            }
            this.cart[item] += quantity;
          },
          toggleSidebar() {
            this.showCart = !this.showCart;
          },
        },
        async mounted() {
          const res = await fetch("./src/food.json");
          const data = await res.json();
          this.inventory = data;
        },
      });

      app.component("sidebar", {
        props: ["toggle", "cart"],
        computed: {
          cartTotal() {
            return this.cart.carrots * 5;
          },
        },
        template: `
            <aside class="cart-container">
                <div class="cart">
                <h1 class="cart-title spread">
                    <span>
                    Cart
                    <i class="fa-solid fa-cart-arrow-down"></i>
                    </span>
                    <button class="cart-close" @click="toggle">&times;</button>
                </h1>

                <div class="cart-body">
                    <table class="cart-table">
                    <thead>
                        <tr>
                        <th><span class="sr-only">Product Image</span></th>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Qty</th>
                        <th>Total</th>
                        <th><span class="sr-only">Actions</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        <td><i class="fa-solid fa-carrot"></i></td>
                        <td>Carrot</td>
                        <td>$5.00</td>
                        <td class="center">{{ cart.carrots }}</td>
                        <td>\${{ cart.carrots * 5}}</td>
                        <td class="center">
                            <button class="btn btn-light cart-remove">&times;</button>
                        </td>
                        </tr>
                    </tbody>
                    </table>

                    <p class="center"><em>No items in cart</em></p>
                    <div class="spread">
                    <span><strong>Total:</strong> \$ {{ cartTotal }}</span>
                    <button class="btn btn-light">Checkout</button>
                    </div>
                </div>
                </div>
            </aside>
        `,
      });

      app.mount("#app");
    </script>
  </body>
</html>
